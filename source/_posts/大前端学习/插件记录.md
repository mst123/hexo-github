---
yontitle: 插件记录
categories: 
  - 大前端
tags: 
  - 插件记录
---
## svg-captcha
图形验证码插件
## nodemailer
邮件服务依赖包
## moment.js
date操作库
## 接口文档管理
showDoc

## uuid

npm uuid

相关应用，图形验证码应用，相关流程如下：

- 客户端在获得图形验证码之前，向服务器发送uuid（唯一标识），存储在localstroage及vuex
- 服务器将uuid及验证码文字，存储在redis中，并设置过期时间 10分钟，并把图形返回客户端
  - `set uuid ax4f 'EX' 60*10`-
- 客户端点击验证时，会把uuid及验证文字发送至服务器
- 服务器根据uuid从redis中获取验证文字，保证验证有效性和实效性

## koa-jwt [链接]([koa-jwt - npm (npmjs.com)](https://www.npmjs.com/package/koa-jwt))

token拦截验证 配套  [jsonwebtoken]([jsonwebtoken - npm (npmjs.com)](https://www.npmjs.com/package/jsonwebtoken)) （生成token）使用

使用流程

- 在主入口引入koa-jwt 并做如下配置

```
import JWT from 'koa-jwt';
const JWT_SECRET = "AS1FAsd24sd!#@5@" //秘钥
// 排除不需要鉴权的路径
const jwt = JWT({ secret: config.JWT_SECRET }).unless({
  path: [
    /^\/public/,
    /\/login/
  ]
})
//添加errorHandle.js 
export default (ctx, next) => {
	// next() 指代的就是jwt 在这就是截获jwt的error
  return next().catch((err) => { 
    if (401 == err.status) { // 鉴权失败会报 code 401
      ctx.status = 401;
      ctx.body = { 
        code: 401,
        msg: 'Protected resource, use Authorization header to get access\n'
      };
    } else {
      throw err;
    }
  });
}
// 顺序不能变，否则会报错
app.use(
	jwt,
	errorHandle
)
```

- 在登陆接口使用 [jsonwebtoken]([jsonwebtoken - npm (npmjs.com)](https://www.npmjs.com/package/jsonwebtoken))插件进行token的生成

```
import jsonwebtoken from 'jsonwebtoken'
const token = jsonwebtoken.sign(
      {
        name: 'ma',
        // exp: Math.floor(Date.now() / 1000) + 60 * 60 * 24 // 过期时间
      },
      config.JWT_SECRET, // 使用相同秘钥
      {
        expiresIn: "1d" // 一天，exp 和 expiresIn只能存在一个
      }
    )
    ctx.body = {
      code: 200,
      token: token
    }
```

- 前端保存获取的token，并在请求头 headers中设置

```
Autorization: Bearer空格token
```







## Npm-run-all

并行执行package.json 脚本命令的工具

```
"scripts": {
    "start": "nodemon --exec babel-node src/index.js",
    "webpack:debug": "node --inspect-brk ./node_modules/.bin/webpack --inline --progress",
    "build": "cross-env NODE_ENV=prod webpack --config config/webpack.config.prod.js",
    "dev": "cross-env NODE_ENV=dev nodemon --exec babel-node --inspect ./src/index.js",
    "clean": "rimraf dist",
    "watch": "cross-env NODE_ENV=dev wabpack --watch --progress --hide-modules --config config/webpack.config.dev.js",
    "debug": "nodemon --inspect ./dist/server.bundle.js",
    "start:dist": "npm-run-all -p watch debug"
  }
  -p 表示并行
  -s 表示串行
```

### Bcrypt   

crypt也可以，[bcrypt](https://www.npmjs.com/package/bcrypt) 更高阶的加密，速度慢了一些，基本感知不到

对密码做哈希处理

```
// hash 处理
bcrypt.hash(myPlaintextPassword, salt(number), function(err, hash) {
	// Store hash in your password DB.
});
// hash 比对
bcrypt.compare(myPlaintextPassword, hash, function(err, result) {
    // result == true
});
```

